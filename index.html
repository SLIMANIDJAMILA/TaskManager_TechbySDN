<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ZenTask - Task Management App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        darkMode: 'class',
        theme: {
          extend: {
            colors: {
              primary: {
                DEFAULT: 'hsl(210, 40%, 50%)',
                light: 'hsl(210, 40%, 60%)',
                dark: 'hsl(210, 40%, 40%)',
              },
            },
            animation: {
              'fade-in': 'fadeIn 0.3s ease-out',
              'slide-in-up': 'slideInUp 0.3s ease-out',
            },
            keyframes: {
              fadeIn: { '0%': { opacity: '0' }, '100%': { opacity: '1' } },
              slideInUp: { '0%': { transform: 'translateY(20px)', opacity: '0' }, '100%': { transform: 'translateY(0)', opacity: '1' } }
            }
          }
        }
      }
    </script>
    <style>
      .modal { display: none; }
      .modal.is-open { display: flex; }
    </style>
<script type="importmap">
{
  "imports": {
    "react/": "https://aistudiocdn.com/react@^19.2.0/",
    "react": "https://aistudiocdn.com/react@^19.2.0",
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.0/"
  }
}
</script>
<link rel="stylesheet" href="/index.css">
</head>
<body class="bg-slate-100 dark:bg-slate-900">
    <div id="app" class="min-h-screen text-slate-800 dark:text-slate-200 transition-colors duration-300">
        <!-- Header -->
        <header class="bg-white/70 dark:bg-slate-800/70 backdrop-blur-lg shadow-sm sticky top-0 z-10">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center">
                <h1 class="text-2xl sm:text-3xl font-bold text-primary dark:text-primary-light">ZenTask</h1>
                <div class="flex items-center space-x-2 sm:space-x-4">
                    <input type="file" id="import-file" class="hidden" accept=".json"/>
                    <button id="import-btn" title="Import Tasks" class="p-2 rounded-full hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors text-slate-800 dark:text-slate-200"></button>
                    <button id="export-btn" title="Export Tasks" class="p-2 rounded-full hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors text-slate-800 dark:text-slate-200"></button>
                    <button id="theme-toggle" title="Toggle Theme" class="p-2 rounded-full hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors"></button>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="container mx-auto p-4 sm:p-6 lg:p-8">
            <!-- Dashboard -->
            <div class="mb-6 p-4 bg-white dark:bg-slate-800 rounded-lg shadow">
                 <h2 class="text-xl font-semibold mb-2">Dashboard</h2>
                 <p id="dashboard-summary" class="text-slate-600 dark:text-slate-400 mb-2"></p>
                 <div class="w-full bg-slate-200 dark:bg-slate-700 rounded-full h-2.5">
                    <div id="progress-bar" class="bg-primary h-2.5 rounded-full transition-all duration-500" style="width: 0%"></div>
                 </div>
            </div>
            
            <!-- Filters -->
            <div class="mb-6 p-4 bg-white dark:bg-slate-800 rounded-lg shadow flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
                <input type="text" id="search-input" placeholder="Search tasks..." class="w-full sm:w-auto flex-grow px-3 py-2 bg-slate-100 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary" />
                <div class="flex flex-col sm:flex-row gap-4">
                    <select id="status-filter" class="px-3 py-2 bg-slate-100 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary"></select>
                    <select id="priority-filter" class="px-3 py-2 bg-slate-100 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary"></select>
                    <select id="sort-by" class="px-3 py-2 bg-slate-100 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary">
                      <option value="dueDate">Sort by Due Date</option>
                      <option value="priority">Sort by Priority</option>
                    </select>
                </div>
            </div>

            <!-- Task List -->
            <div id="task-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
            <div id="no-tasks-message" class="text-center py-12 hidden">
                <p class="text-slate-500 dark:text-slate-400">No tasks found. Try adjusting your filters or adding a new task!</p>
            </div>
        </main>

        <!-- Add Task Button -->
        <button id="add-task-btn" class="fixed bottom-8 right-8 bg-primary hover:bg-primary-dark text-white rounded-full p-4 shadow-lg transition-transform transform hover:scale-110 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary dark:focus:ring-offset-slate-900"></button>

        <!-- Task Modal -->
        <div id="task-modal" class="modal fixed inset-0 bg-black bg-opacity-50 z-50 justify-center items-center animate-fade-in">
            <div class="bg-white dark:bg-slate-800 rounded-lg shadow-xl p-6 w-full max-w-lg mx-4 animate-slide-in-up" id="modal-content">
                <h2 id="modal-title" class="text-2xl font-bold mb-4"></h2>
                <form id="task-form" class="space-y-4">
                    <input type="hidden" id="task-id" name="id">
                    <div>
                        <label for="title" class="block text-sm font-medium text-slate-700 dark:text-slate-300">Title</label>
                        <input type="text" id="title" name="title" required class="mt-1 block w-full px-3 py-2 bg-white dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-md shadow-sm placeholder-slate-400 focus:outline-none focus:ring-primary focus:border-primary sm:text-sm text-slate-900 dark:text-slate-100" />
                    </div>
                    <div>
                        <label for="description" class="block text-sm font-medium text-slate-700 dark:text-slate-300">Description</label>
                        <textarea id="description" name="description" rows="3" class="mt-1 block w-full px-3 py-2 bg-white dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-md shadow-sm placeholder-slate-400 focus:outline-none focus:ring-primary focus:border-primary sm:text-sm text-slate-900 dark:text-slate-100"></textarea>
                    </div>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <div>
                            <label for="dueDate" class="block text-sm font-medium text-slate-700 dark:text-slate-300">Due Date</label>
                            <input type="date" id="dueDate" name="dueDate" required class="mt-1 block w-full px-3 py-2 bg-white dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary sm:text-sm text-slate-900 dark:text-slate-100" />
                        </div>
                        <div>
                            <label for="priority" class="block text-sm font-medium text-slate-700 dark:text-slate-300">Priority</label>
                            <select id="priority" name="priority" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 focus:outline-none focus:ring-primary focus:border-primary sm:text-sm rounded-md"></select>
                        </div>
                    </div>
                    <div id="status-wrapper">
                        <label for="status" class="block text-sm font-medium text-slate-700 dark:text-slate-300">Status</label>
                        <select id="status" name="status" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 focus:outline-none focus:ring-primary focus:border-primary sm:text-sm rounded-md"></select>
                    </div>
                    <div class="flex justify-end space-x-3 pt-4">
                        <button type="button" id="cancel-btn" class="px-4 py-2 bg-slate-200 text-slate-800 rounded-md hover:bg-slate-300 dark:bg-slate-600 dark:text-slate-100 dark:hover:bg-slate-500 transition-colors">Cancel</button>
                        <button type="submit" class="px-4 py-2 bg-primary text-white rounded-md hover:bg-primary-dark transition-colors">Save Task</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // === CONSTANTS & ENUMS ===
        const Status = { ToDo: 'To Do', InProgress: 'In Progress', Completed: 'Completed' };
        const Priority = { Low: 'Low', Medium: 'Medium', High: 'High' };
        
        const initialTasks = [
          { id: '1', title: 'Setup Project', description: 'Initialize project with HTML, CSS, and vanilla JS.', dueDate: '2024-08-15', priority: Priority.High, status: Status.Completed },
          { id: '2', title: 'Create UI', description: 'Build all necessary UI components and layout.', dueDate: '2024-08-18', priority: Priority.High, status: Status.InProgress },
          { id: '3', title: 'Implement Logic', description: 'Write JavaScript for state management and interactivity.', dueDate: '2024-08-20', priority: Priority.Medium, status: Status.ToDo },
          { id: '4', title: 'Add Dark Mode', description: 'Implement a toggle for light and dark themes.', dueDate: '2024-08-22', priority: Priority.Low, status: Status.ToDo },
        ];

        // === SVG ICONS ===
        const icons = {
          plus: `<svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" /></svg>`,
          edit: `<svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg>`,
          trash: `<svg xmlns="http://www.w.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>`,
          sun: `<svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 sm:w-6 sm:h-6 text-yellow-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M12 12a5 5 0 100-10 5 5 0 000 10z" /></svg>`,
          moon: `<svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 sm:w-6 sm:h-6 text-slate-700" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" /></svg>`,
          upload: `<svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 sm:w-6 sm:h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" /></svg>`,
          download: `<svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 sm:w-6 sm:h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" /></svg>`,
        };

        // === STATE ===
        let tasks = [];
        let isDarkMode = false;
        let taskToEdit = null;

        // === DOM ELEMENTS ===
        const taskList = document.getElementById('task-list');
        const addTaskBtn = document.getElementById('add-task-btn');
        const taskModal = document.getElementById('task-modal');
        const modalContent = document.getElementById('modal-content');
        const cancelBtn = document.getElementById('cancel-btn');
        const taskForm = document.getElementById('task-form');
        const modalTitle = document.getElementById('modal-title');
        const statusWrapper = document.getElementById('status-wrapper');
        const searchInput = document.getElementById('search-input');
        const statusFilter = document.getElementById('status-filter');
        const priorityFilter = document.getElementById('priority-filter');
        const sortBy = document.getElementById('sort-by');
        const noTasksMessage = document.getElementById('no-tasks-message');
        const dashboardSummary = document.getElementById('dashboard-summary');
        const progressBar = document.getElementById('progress-bar');
        const themeToggle = document.getElementById('theme-toggle');
        const importBtn = document.getElementById('import-btn');
        const exportBtn = document.getElementById('export-btn');
        const importFile = document.getElementById('import-file');
        
        // === RENDER & UI FUNCTIONS ===
        const renderTasks = () => {
            const searchTerm = searchInput.value.toLowerCase();
            const statusF = statusFilter.value;
            const priorityF = priorityFilter.value;
            const sort = sortBy.value;

            const priorityOrder = { [Priority.High]: 1, [Priority.Medium]: 2, [Priority.Low]: 3 };

            const filtered = tasks
                .filter(task => {
                    const matchesSearch = task.title.toLowerCase().includes(searchTerm) || task.description.toLowerCase().includes(searchTerm);
                    const matchesStatus = statusF === 'All' || task.status === statusF;
                    const matchesPriority = priorityF === 'All' || task.priority === priorityF;
                    return matchesSearch && matchesStatus && matchesPriority;
                })
                .sort((a, b) => {
                    if (sort === 'dueDate') return new Date(a.dueDate).getTime() - new Date(b.dueDate).getTime();
                    return priorityOrder[a.priority] - priorityOrder[b.priority];
                });

            taskList.innerHTML = '';
            if (filtered.length === 0) {
                noTasksMessage.classList.remove('hidden');
            } else {
                noTasksMessage.classList.add('hidden');
                filtered.forEach(task => {
                    const taskCard = createTaskCard(task);
                    taskList.insertAdjacentHTML('beforeend', taskCard);
                });
            }
            updateDashboard();
        };

        const createTaskCard = (task) => {
            const priorityColors = { [Priority.Low]: 'border-l-green-500', [Priority.Medium]: 'border-l-yellow-500', [Priority.High]: 'border-l-red-500' };
            const statusColors = { [Status.ToDo]: 'bg-slate-500', [Status.InProgress]: 'bg-blue-500', [Status.Completed]: 'bg-green-600' };
            const isOverdue = new Date(task.dueDate) < new Date() && task.status !== Status.Completed;
            
            const statusOptions = Object.values(Status).map(s => `<option value="${s}" ${task.status === s ? 'selected' : ''}>${s}</option>`).join('');

            return `
                <div class="bg-white dark:bg-slate-800 rounded-lg shadow-md p-4 flex flex-col justify-between border-l-4 ${priorityColors[task.priority]} transition-transform transform hover:scale-105 animate-slide-in-up">
                  <div>
                    <div class="flex justify-between items-start mb-2">
                      <h3 class="font-bold text-lg text-slate-800 dark:text-slate-100">${task.title}</h3>
                      <div class="flex items-center space-x-2">
                        <button data-action="edit" data-id="${task.id}" class="text-slate-500 hover:text-blue-500 dark:hover:text-blue-400 transition-colors">${icons.edit}</button>
                        <button data-action="delete" data-id="${task.id}" class="text-slate-500 hover:text-red-500 dark:hover:text-red-400 transition-colors">${icons.trash}</button>
                      </div>
                    </div>
                    <p class="text-slate-600 dark:text-slate-400 text-sm mb-4">${task.description}</p>
                  </div>
                  <div class="flex flex-col space-y-3 text-sm">
                    <div class="flex justify-between items-center">
                      <span class="font-semibold text-slate-700 dark:text-slate-300">Due Date:</span>
                      <span class="px-2 py-1 rounded-full text-xs font-medium ${isOverdue ? 'bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200' : 'bg-slate-200 text-slate-700 dark:bg-slate-700 dark:text-slate-200'}">
                        ${new Date(task.dueDate).toLocaleDateString()}
                      </span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="font-semibold text-slate-700 dark:text-slate-300">Status:</span>
                        <select data-action="status" data-id="${task.id}" class="text-white text-xs font-semibold px-2 py-1 rounded-full appearance-none border-none focus:ring-2 focus:ring-offset-2 focus:ring-primary dark:focus:ring-offset-slate-800 ${statusColors[task.status]}">
                          ${statusOptions}
                        </select>
                    </div>
                  </div>
                </div>`;
        };
        
        const updateDashboard = () => {
          const completed = tasks.filter(t => t.status === Status.Completed).length;
          const total = tasks.length;
          const percentage = total > 0 ? (completed / total) * 100 : 0;
          dashboardSummary.textContent = `${completed} of ${total} tasks completed.`;
          progressBar.style.width = `${percentage}%`;
        };

        const updateThemeToggleIcon = () => {
            themeToggle.innerHTML = isDarkMode ? icons.sun : icons.moon;
        };

        // === MODAL LOGIC ===
        const openModal = (task = null) => {
            taskToEdit = task;
            taskForm.reset();
            if (task) {
                modalTitle.textContent = 'Edit Task';
                statusWrapper.style.display = 'none'; // Status is changed on the card directly
                taskForm.elements['id'].value = task.id;
                taskForm.elements['title'].value = task.title;
                taskForm.elements['description'].value = task.description;
                taskForm.elements['dueDate'].value = task.dueDate;
                taskForm.elements['priority'].value = task.priority;
            } else {
                modalTitle.textContent = 'Add New Task';
                statusWrapper.style.display = 'block';
                taskForm.elements['dueDate'].value = new Date().toISOString().split('T')[0];
                taskForm.elements['priority'].value = Priority.Medium;
                taskForm.elements['status'].value = Status.ToDo;
            }
            taskModal.classList.add('is-open');
        };

        const closeModal = () => {
            taskModal.classList.remove('is-open');
            taskToEdit = null;
        };

        const handleSaveTask = (e) => {
            e.preventDefault();
            const formData = new FormData(taskForm);
            const taskData = Object.fromEntries(formData.entries());

            if (taskToEdit) {
                const existingTask = tasks.find(t => t.id === taskToEdit.id);
                tasks = tasks.map(t => t.id === taskToEdit.id ? { ...existingTask, ...taskData } : t);
            } else {
                tasks.push({
                    ...taskData,
                    id: Date.now().toString(),
                });
            }
            saveTasks();
            renderTasks();
            closeModal();
        };

        // === DATA PERSISTENCE ===
        const loadState = () => {
            try {
              const storedTasks = localStorage.getItem('tasks');
              tasks = storedTasks ? JSON.parse(storedTasks) : initialTasks;
              
              const storedTheme = localStorage.getItem('theme');
              if (storedTheme === 'dark') {
                  isDarkMode = true;
                  document.documentElement.classList.add('dark');
              }
            } catch (e) {
                console.error("Failed to load state from localStorage", e);
                tasks = initialTasks;
            }
        };

        const saveTasks = () => {
            localStorage.setItem('tasks', JSON.stringify(tasks));
        };
        
        const saveTheme = () => {
            localStorage.setItem('theme', isDarkMode ? 'dark' : 'light');
        };

        // === EVENT HANDLERS ===
        const handleTaskAction = (e) => {
            const target = e.target.closest('[data-action]');
            if (!target) return;
            
            const action = target.dataset.action;
            const id = target.dataset.id;
            
            if (action === 'edit') {
                const task = tasks.find(t => t.id === id);
                if (task) openModal(task);
            } else if (action === 'delete') {
                if (confirm('Are you sure you want to delete this task?')) {
                    tasks = tasks.filter(t => t.id !== id);
                    saveTasks();
                    renderTasks();
                }
            } else if (action === 'status') {
                const newStatus = target.value;
                tasks = tasks.map(t => t.id === id ? { ...t, status: newStatus } : t);
                saveTasks();
                renderTasks(); // Re-render to update colors and potentially position
            }
        };
        
        const toggleDarkMode = () => {
            isDarkMode = !isDarkMode;
            document.documentElement.classList.toggle('dark');
            saveTheme();
            updateThemeToggleIcon();
        };

        const handleExport = () => {
            const dataStr = JSON.stringify(tasks, null, 2);
            const blob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'tasks.json';
            a.click();
            URL.revokeObjectURL(url);
        };
        
        const handleImport = (e) => {
            const file = e.target.files?.[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (event) => {
                try {
                    const imported = JSON.parse(event.target.result);
                    if (Array.isArray(imported) && imported.every(t => 'id' in t && 'title' in t)) {
                        if (confirm('This will overwrite your current tasks. Are you sure?')) {
                            tasks = imported;
                            saveTasks();
                            renderTasks();
                        }
                    } else {
                        alert('Invalid JSON file format.');
                    }
                } catch (error) {
                    alert('Error reading or parsing the file.');
                }
            };
            reader.readAsText(file);
            e.target.value = ''; // Reset input
        };
        
        // === INITIALIZATION ===
        const init = () => {
            // Setup icons
            addTaskBtn.innerHTML = icons.plus;
            themeToggle.innerHTML = icons.moon;
            importBtn.innerHTML = icons.upload;
            exportBtn.innerHTML = icons.download;

            // Setup select options
            const setupSelect = (element, options, allLabel) => {
                element.innerHTML = `<option value="All">${allLabel}</option>` +
                    Object.values(options).map(o => `<option value="${o}">${o}</option>`).join('');
            };
            const setupModalSelect = (element, options) => {
                 element.innerHTML = Object.values(options).map(o => `<option value="${o}">${o}</option>`).join('');
            }
            
            setupSelect(statusFilter, Status, 'All Statuses');
            setupSelect(priorityFilter, Priority, 'All Priorities');
            setupModalSelect(document.getElementById('priority'), Priority);
            setupModalSelect(document.getElementById('status'), Status);
            
            // Setup event listeners
            addTaskBtn.addEventListener('click', () => openModal());
            cancelBtn.addEventListener('click', closeModal);
            taskModal.addEventListener('click', (e) => {
                if (e.target === taskModal) closeModal();
            });
            taskForm.addEventListener('submit', handleSaveTask);
            taskList.addEventListener('click', handleTaskAction);
            taskList.addEventListener('change', handleTaskAction);
            
            [searchInput, statusFilter, priorityFilter, sortBy].forEach(el => {
                el.addEventListener('input', renderTasks);
            });
            
            themeToggle.addEventListener('click', toggleDarkMode);
            exportBtn.addEventListener('click', handleExport);
            importBtn.addEventListener('click', () => importFile.click());
            importFile.addEventListener('change', handleImport);

            // Load data and initial render
            loadState();
            updateThemeToggleIcon();
            renderTasks();
        };

        init();
    });
    </script>
<script type="module" src="/index.tsx"></script>
</body>
</html>
